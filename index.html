<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico Rural - Offline</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4a7c59">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="DiagRural">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%234a7c59' width='100' height='100' rx='15'/%3E%3Ctext y='70' font-size='60' text-anchor='middle' x='50'%3Eüåæ%3C/text%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4a7c59 0%, #6b8e23 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2d4a32;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: linear-gradient(45deg, #4a7c59, #6b8e23);
            border-radius: 10px;
            margin-bottom: 30px;
            color: white;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #fff;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .form-sections {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .section {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            background: #fafafa;
        }

        .section h2 {
            color: #2d4a32;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a7c59;
            font-size: 1.5em;
        }

        .section h3 {
            color: #4a7c59;
            margin: 20px 0 15px 0;
            font-size: 1.2em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group-inline {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4a7c59;
            box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-group, .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .checkbox-item, .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"], input[type="radio"] {
            width: auto;
            margin: 0;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4a7c59, #6b8e23);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .saved-data {
            margin-top: 40px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
        }

        .saved-data h3 {
            color: #2d4a32;
            margin-bottom: 20px;
        }

        .data-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid #4a7c59;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .data-item small {
            color: #666;
            display: block;
            margin-bottom: 10px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: all 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
        }

        .notification.info {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }

        .section-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 10px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 8px 15px;
            background: #4a7c59;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4a7c59, #6b8e23);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid-2 {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .section-navigation {
                flex-direction: column;
                gap: 15px;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåæ Diagn√≥stico Rural</h1>
            <p>Sistema Offline - Coleta de dados agropecu√°rios</p>
        </div>

        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="statusText">Modo Offline - Dados salvos localmente</span>
            </div>
            <div id="dataCount">0 diagn√≥sticos salvos</div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 16.67%"></div>
        </div>

        <div class="section-navigation">
            <div>
                <span>Se√ß√£o <span id="currentSection">1</span> de 6: <span id="sectionTitle">Dados do Agricultor</span>
            </div>
            <div class="nav-buttons">
                <button class="nav-btn" id="prevBtn" onclick="previousSection()" disabled>‚Üê Anterior</button>
                <button class="nav-btn" id="nextBtn" onclick="nextSection()">Pr√≥ximo ‚Üí</button>
            </div>
        </div>

        <form id="diagnosticoForm">
            <!-- Se√ß√£o 1: Dados do Agricultor -->
            <div class="section form-section active" id="section1">
                <h2>üë®‚Äçüåæ Dados do Agricultor</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nome">Nome Completo:</label>
                        <input type="text" id="nome" name="nome" required>
                    </div>
                    <div class="form-group">
                        <label for="nomeMae">Nome da M√£e:</label>
                        <input type="text" id="nomeMae" name="nomeMae">
                    </div>
                    <div class="form-group">
                        <label for="dataNascimento">Data de Nascimento:</label>
                        <input type="date" id="dataNascimento" name="dataNascimento">
                    </div>
                    <div class="form-group">
                        <label for="estadoCivil">Estado Civil:</label>
                        <select id="estadoCivil" name="estadoCivil">
                            <option value="">Selecione...</option>
                            <option value="solteiro">Solteiro(a)</option>
                            <option value="casado">Casado(a)</option>
                            <option value="divorciado">Divorciado(a)</option>
                            <option value="viuvo">Vi√∫vo(a)</option>
                            <option value="uniao_estavel">Uni√£o Est√°vel</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="identidade">RG:</label>
                        <input type="text" id="identidade" name="identidade">
                    </div>
                    <div class="form-group">
                        <label for="cpf">CPF:</label>
                        <input type="text" id="cpf" name="cpf">
                    </div>
                    <div class="form-group">
                        <label for="naturalidade">Naturalidade:</label>
                        <input type="text" id="naturalidade" name="naturalidade">
                    </div>
                    <div class="form-group">
                        <label for="grauInstrucao">Grau de Instru√ß√£o:</label>
                        <select id="grauInstrucao" name="grauInstrucao">
                            <option value="">Selecione...</option>
                            <option value="analfabeto">Analfabeto</option>
                            <option value="fundamental_incompleto">Fundamental Incompleto</option>
                            <option value="fundamental_completo">Fundamental Completo</option>
                            <option value="medio_incompleto">M√©dio Incompleto</option>
                            <option value="medio_completo">M√©dio Completo</option>
                            <option value="superior_incompleto">Superior Incompleto</option>
                            <option value="superior_completo">Superior Completo</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="endereco">Endere√ßo Residencial:</label>
                        <input type="text" id="endereco" name="endereco">
                    </div>
                    <div class="form-group">
                        <label for="municipio">Munic√≠pio:</label>
                        <input type="text" id="municipio" name="municipio">
                    </div>
                    <div class="form-group">
                        <label for="uf">UF:</label>
                        <select id="uf" name="uf">
                            <option value="">Selecione...</option>
                            <option value="AC">AC</option>
                            <option value="AL">AL</option>
                            <option value="AP">AP</option>
                            <option value="AM">AM</option>
                            <option value="BA">BA</option>
                            <option value="CE">CE</option>
                            <option value="DF">DF</option>
                            <option value="ES">ES</option>
                            <option value="GO">GO</option>
                            <option value="MA">MA</option>
                            <option value="MT">MT</option>
                            <option value="MS">MS</option>
                            <option value="MG">MG</option>
                            <option value="PA">PA</option>
                            <option value="PB">PB</option>
                            <option value="PR">PR</option>
                            <option value="PE">PE</option>
                            <option value="PI">PI</option>
                            <option value="RJ">RJ</option>
                            <option value="RN">RN</option>
                            <option value="RS">RS</option>
                            <option value="RO">RO</option>
                            <option value="RR">RR</option>
                            <option value="SC">SC</option>
                            <option value="SP">SP</option>
                            <option value="SE">SE</option>
                            <option value="TO">TO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="telefone">Telefone/Celular:</label>
                        <input type="tel" id="telefone" name="telefone">
                    </div>
                    <div class="form-group">
                        <label for="email">E-mail:</label>
                        <input type="email" id="email" name="email">
                    </div>
                    <div class="form-group">
                        <label for="instagram">Instagram:</label>
                        <input type="text" id="instagram" name="instagram">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="classificacaoProdutor">Classifica√ß√£o do Produtor:</label>
                        <select id="classificacaoProdutor" name="classificacaoProdutor">
                            <option value="">Selecione...</option>
                            <option value="pequeno">Pequeno</option>
                            <option value="medio">M√©dio</option>
                            <option value="grande">Grande</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dap">DAP n¬∫:</label>
                        <input type="text" id="dap" name="dap">
                    </div>
                    <div class="form-group">
                        <label for="caf">CAF n¬∫:</label>
                        <input type="text" id="caf" name="caf">
                    </div>
                </div>

                <div class="form-group">
                    <label>Participa de:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="associacao" name="participacao" value="associacao">
                            <label for="associacao">Associa√ß√£o</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="sindicato" name="participacao" value="sindicato">
                            <label for="sindicato">Sindicato</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cooperativa" name="participacao" value="cooperativa">
                            <label for="cooperativa">Cooperativa</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="origemRenda">Qual a origem da renda familiar?</label>
                    <textarea id="origemRenda" name="origemRenda"></textarea>
                </div>

                <h3>üë• Dados do C√¥njuge</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nomeConjuge">Nome do C√¥njuge:</label>
                        <input type="text" id="nomeConjuge" name="nomeConjuge">
                    </div>
                    <div class="form-group">
                        <label for="dataNascimentoConjuge">Data de Nascimento:</label>
                        <input type="date" id="dataNascimentoConjuge" name="dataNascimentoConjuge">
                    </div>
                    <div class="form-group">
                        <label for="grauInstrucaoConjuge">Grau de Instru√ß√£o:</label>
                        <select id="grauInstrucaoConjuge" name="grauInstrucaoConjuge">
                            <option value="">Selecione...</option>
                            <option value="analfabeto">Analfabeto</option>
                            <option value="fundamental_incompleto">Fundamental Incompleto</option>
                            <option value="fundamental_completo">Fundamental Completo</option>
                            <option value="medio_incompleto">M√©dio Incompleto</option>
                            <option value="medio_completo">M√©dio Completo</option>
                            <option value="superior_incompleto">Superior Incompleto</option>
                            <option value="superior_completo">Superior Completo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="trabalhoPropriedade">Trabalho na Propriedade:</label>
                        <textarea id="trabalhoPropriedade" name="trabalhoPropriedade"></textarea>
                    </div>
                </div>

                <div class="form-grid-2">
                    <div class="form-group">
                        <label for="possuiFilhos">Possui filhos? Quantos?</label>
                        <input type="number" id="possuiFilhos" name="possuiFilhos" min="0">
                    </div>
                    <div class="form-group">
                        <label for="filhosEscola">Filhos na escola?</label>
                        <select id="filhosEscola" name="filhosEscola">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                            <option value="alguns">Alguns</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filhosTrabalham">Filhos trabalham na propriedade?</label>
                        <select id="filhosTrabalham" name="filhosTrabalham">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                            <option value="alguns">Alguns</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="aposentados">Aposentados na propriedade:</label>
                        <input type="number" id="aposentados" name="aposentados" min="0">
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 2: Dados da Propriedade -->
            <div class="section form-section hidden" id="section2">
                <h2>üè† Dados da Propriedade</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nomePropriedade">Nome da Propriedade:</label>
                        <input type="text" id="nomePropriedade" name="nomePropriedade">
                    </div>
                    <div class="form-group">
                        <label for="enderecoPropriedade">Endere√ßo:</label>
                        <input type="text" id="enderecoPropriedade" name="enderecoPropriedade">
                    </div>
                    <div class="form-group">
                        <label for="municipioPropriedade">Munic√≠pio:</label>
                        <input type="text" id="municipioPropriedade" name="municipioPropriedade">
                    </div>
                    <div class="form-group">
                        <label for="ufPropriedade">UF:</label>
                        <select id="ufPropriedade" name="ufPropriedade">
                            <option value="">Selecione...</option>
                            <option value="AC">AC</option>
                            <option value="AL">AL</option>
                            <option value="AP">AP</option>
                            <option value="AM">AM</option>
                            <option value="BA">BA</option>
                            <option value="CE">CE</option>
                            <option value="DF">DF</option>
                            <option value="ES">ES</option>
                            <option value="GO">GO</option>
                            <option value="MA">MA</option>
                            <option value="MT">MT</option>
                            <option value="MS">MS</option>
                            <option value="MG">MG</option>
                            <option value="PA">PA</option>
                            <option value="PB">PB</option>
                            <option value="PR">PR</option>
                            <option value="PE">PE</option>
                            <option value="PI">PI</option>
                            <option value="RJ">RJ</option>
                            <option value="RN">RN</option>
                            <option value="RS">RS</option>
                            <option value="RO">RO</option>
                            <option value="RR">RR</option>
                            <option value="SC">SC</option>
                            <option value="SP">SP</option>
                            <option value="SE">SE</option>
                            <option value="TO">TO</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="areaTotal">√Årea Total (hectares):</label>
                        <input type="number" id="areaTotal" name="areaTotal" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="areaProducao">√Årea de Produ√ß√£o (hectares):</label>
                        <input type="number" id="areaProducao" name="areaProducao" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="localizacaoGeo">Localiza√ß√£o Geogr√°fica:</label>
                        <input type="text" id="localizacaoGeo" name="localizacaoGeo" placeholder="GPS coordenadas">
                    </div>
                </div>

                <div class="form-group">
                    <label for="confrontantes">Confrontantes (Norte, Sul, Leste, Oeste):</label>
                    <textarea id="confrontantes" name="confrontantes"></textarea>
                </div>

                <h3>üìÑ Condi√ß√£o de Posse</h3>
                <div class="form-group">
                    <label>Documenta√ß√£o:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="escrituraPublica" name="documentacao" value="escritura_publica">
                            <label for="escrituraPublica">Escritura P√∫blica</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="itr" name="documentacao" value="itr">
                            <label for="itr">ITR</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ccir" name="documentacao" value="ccir">
                            <label for="ccir">CCIR</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="tituloDoacao" name="documentacao" value="titulo_doacao">
                            <label for="tituloDoacao">T√≠tulo de Doa√ß√£o</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="posseiro" name="documentacao" value="posseiro">
                            <label for="posseiro">Posseiro</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="caseiro" name="documentacao" value="caseiro">
                            <label for="caseiro">Caseiro</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="arrendamento" name="documentacao" value="arrendamento">
                            <label for="arrendamento">Arrendamento</label>
                        </div>
                    </div>
                </div>

                <h3>üö∞ Uso da Terra e Infraestrutura</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="tipoPlantio">Tipo de Plantio:</label>
                        <input type="text" id="tipoPlantio" name="tipoPlantio">
                    </div>
                    <div class="form-group">
                        <label for="tipoIrrigacao">Tipo de Irriga√ß√£o:</label>
                        <select id="tipoIrrigacao" name="tipoIrrigacao">
                            <option value="">Selecione...</option>
                            <option value="aspersao">Aspers√£o</option>
                            <option value="gotejamento">Gotejamento</option>
                            <option value="microaspersao">Microaspers√£o</option>
                            <option value="sulco">Sulco</option>
                            <option value="nao_irrigado">N√£o Irrigado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fonteCaptacao">Fonte de Capta√ß√£o:</label>
                        <input type="text" id="fonteCaptacao" name="fonteCaptacao">
                    </div>
                </div>

                <div class="form-group">
                    <label>Fontes de √Ågua:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="pocoArtesiano" name="fontesAgua" value="poco_artesiano">
                            <label for="pocoArtesiano">Po√ßo Artesiano</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cisternaPlaca" name="fontesAgua" value="cisterna_placa">
                            <label for="cisternaPlaca">Cisterna de Placa</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cisternaCalcadao" name="fontesAgua" value="cisterna_calcadao">
                            <label for="cisternaCalcadao">Cisterna Cal√ßad√£o</label>
                        </div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="temOutorga">Possui Outorga?</label>
                        <select id="temOutorga" name="temOutorga">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                            <option value="em_processo">Em Processo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="acessoPropriedade">Acesso √† Propriedade:</label>
                        <select id="acessoPropriedade" name="acessoPropriedade">
                            <option value="">Selecione...</option>
                            <option value="bom">Bom</option>
                            <option value="regular">Regular</option>
                            <option value="ruim">Ruim</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tipoEnergia">Tipo de Energia:</label>
                        <select id="tipoEnergia" name="tipoEnergia">
                            <option value="">Selecione...</option>
                            <option value="eletrica">El√©trica</option>
                            <option value="solar">Solar</option>
                            <option value="gerador">Gerador</option>
                            <option value="nao_possui">N√£o Possui</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="conectividade">Possui Conectividade (Internet)?</label>
                        <select id="conectividade" name="conectividade">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                            <option value="limitada">Limitada</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 3: Produ√ß√£o Agr√≠cola -->
            <div class="section form-section hidden" id="section3">
                <h2>üåæ Produ√ß√£o Agr√≠cola</h2>
                
                <div class="form-group">
                    <label for="culturasProducao">Quais culturas s√£o produzidas na propriedade?</label>
                    <textarea id="culturasProducao" name="culturasProducao"></textarea>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="culturasPerenes">Culturas Perenes (√°rea e produ√ß√£o):</label>
                        <textarea id="culturasPerenes" name="culturasPerenes"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="culturasTemporarias">Culturas Tempor√°rias (√°rea e produ√ß√£o):</label>
                        <textarea id="culturasTemporarias" name="culturasTemporarias"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="culturaPrincipal">Cultura Principal:</label>
                        <input type="text" id="culturaPrincipal" name="culturaPrincipal">
                    </div>
                    <div class="form-group">
                        <label for="variedadePlantada">Variedade Plantada:</label>
                        <input type="text" id="variedadePlantada" name="variedadePlantada">
                    </div>
                </div>

                <div class="form-group">
                    <label for="hortalicas">Hortali√ßas em Geral:</label>
                    <textarea id="hortalicas" name="hortalicas"></textarea>
                </div>

                <h3>üß™ T√©cnicas de Cultivo</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="analiseSolo">√â realizada an√°lise de solo?</label>
                        <select id="analiseSolo" name="analiseSolo">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                            <option value="as_vezes">√Äs vezes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="calagem">√â feita calagem? Frequ√™ncia:</label>
                        <input type="text" id="calagem" name="calagem" placeholder="Ex: Anual, bianual...">
                    </div>
                    <div class="form-group">
                        <label for="tecnicasCultivo">T√©cnicas de Cultivo:</label>
                        <select id="tecnicasCultivo" name="tecnicasCultivo">
                            <option value="">Selecione...</option>
                            <option value="organico">Org√¢nico</option>
                            <option value="convencional">Convencional</option>
                            <option value="misto">Misto</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Pr√°ticas Utilizadas:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="adubacaoVerde" name="praticas" value="adubacao_verde">
                            <label for="adubacaoVerde">Aduba√ß√£o Verde</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cultivoIrrigado" name="praticas" value="cultivo_irrigado">
                            <label for="cultivoIrrigado">Cultivo Irrigado</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fertirrigacao" name="praticas" value="fertirrigacao">
                            <label for="fertirrigacao">Fertirriga√ß√£o</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="coberturaMorta" name="praticas" value="cobertura_morta">
                            <label for="coberturaMorta">Cobertura Morta</label>
                        </div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="seloCertificacao">Possui selo de certifica√ß√£o?</label>
                        <input type="text" id="seloCertificacao" name="seloCertificacao" placeholder="Qual selo?">
                    </div>
                    <div class="form-group">
                        <label for="investimentoSementes">Investimento em sementes (12 meses)?</label>
                        <input type="number" id="investimentoSementes" name="investimentoSementes" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="mediaProducao">M√©dia de produ√ß√£o por cultura:</label>
                        <textarea id="mediaProducao" name="mediaProducao"></textarea>
                    </div>
                </div>

                <h3>üöú Implementos e Colheita</h3>
                <div class="form-group">
                    <label>Implementos Agr√≠colas:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="implPreparoSolo" name="implementos" value="preparo_solo">
                            <label for="implPreparoSolo">Preparo do Solo</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="implPlantio" name="implementos" value="plantio">
                            <label for="implPlantio">Plantio</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="implTratosCulturais" name="implementos" value="tratos_culturais">
                            <label for="implTratosCulturais">Tratos Culturais</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="implColheita" name="implementos" value="colheita">
                            <label for="implColheita">Colheita</label>
                        </div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="tipoColheita">Tipo de Colheita:</label>
                        <select id="tipoColheita" name="tipoColheita">
                            <option value="">Selecione...</option>
                            <option value="manual">Manual</option>
                            <option value="mecanizada">Mecanizada</option>
                            <option value="mista">Mista</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="quantidadeColhida">Quantidade colhida no √∫ltimo ano:</label>
                        <input type="text" id="quantidadeColhida" name="quantidadeColhida">
                    </div>
                </div>

                <div class="form-group">
                    <label>Estruturas:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="estruturaBeneficiamento" name="estruturas" value="beneficiamento">
                            <label for="estruturaBeneficiamento">Beneficiamento</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="estruturaArmazenagem" name="estruturas" value="armazenagem">
                            <label for="estruturaArmazenagem">Armazenagem</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="produzSilagem" name="estruturas" value="silagem">
                            <label for="produzSilagem">Produz Silagem</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="produzFeno" name="estruturas" value="feno">
                            <label for="produzFeno">Produz Feno</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="comercializacao">Como √© feita a comercializa√ß√£o dos produtos?</label>
                    <textarea id="comercializacao" name="comercializacao"></textarea>
                </div>

                <div class="form-group">
                    <label for="problemasProducao">Principais problemas enfrentados na produ√ß√£o:</label>
                    <textarea id="problemasProducao" name="problemasProducao"></textarea>
                </div>
            </div>

            <!-- Se√ß√£o 4: Produ√ß√£o Pecu√°ria -->
            <div class="section form-section hidden" id="section4">
                <h2>üêÑ Produ√ß√£o Pecu√°ria</h2>
                
                <h3>üêÇ Bovinos</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="bovinosProducaoOrganica">Produ√ß√£o Org√¢nica?</label>
                        <select id="bovinosProducaoOrganica" name="bovinosProducaoOrganica">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bovinosNumero">N√∫mero de animais (12 meses):</label>
                        <input type="number" id="bovinosNumero" name="bovinosNumero" min="0">
                    </div>
                    <div class="form-group">
                        <label for="bovinosValorTotal">Valor total dos animais (R$):</label>
                        <input type="number" id="bovinosValorTotal" name="bovinosValorTotal" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="bovinosProducaoVendida">Produ√ß√£o vendida (kg):</label>
                        <input type="number" id="bovinosProducaoVendida" name="bovinosProducaoVendida" step="0.01">
                    </div>
                </div>

                <div class="form-group">
                    <label>Produtos Bovinos:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="bovinosCarne" name="produtosBovinos" value="carne">
                            <label for="bovinosCarne">Carne</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="bovinosLeite" name="produtosBovinos" value="leite">
                            <label for="bovinosLeite">Leite</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="bovinosQueijo" name="produtosBovinos" value="queijo">
                            <label for="bovinosQueijo">Queijo</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="bovinosCarneSeca" name="produtosBovinos" value="carne_seca">
                            <label for="bovinosCarneSeca">Carne Seca</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="bovinosCarneSol" name="produtosBovinos" value="carne_sol">
                            <label for="bovinosCarneSol">Carne de Sol</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="bovinosVisceras" name="produtosBovinos" value="visceras">
                            <label for="bovinosVisceras">V√≠sceras</label>
                        </div>
                    </div>
                </div>

                <h3>üê∑ Su√≠nos</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="suinosNumero">N√∫mero de animais (12 meses):</label>
                        <input type="number" id="suinosNumero" name="suinosNumero" min="0">
                    </div>
                    <div class="form-group">
                        <label for="suinosValorTotal">Valor total dos animais (R$):</label>
                        <input type="number" id="suinosValorTotal" name="suinosValorTotal" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="suinosProducaoVendida">Produ√ß√£o vendida (kg):</label>
                        <input type="number" id="suinosProducaoVendida" name="suinosProducaoVendida" step="0.01">
                    </div>
                </div>

                <h3>üêê Caprinos</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="caprinosNumero">N√∫mero de animais (12 meses):</label>
                        <input type="number" id="caprinosNumero" name="caprinosNumero" min="0">
                    </div>
                    <div class="form-group">
                        <label for="caprinosValorTotal">Valor total dos animais (R$):</label>
                        <input type="number" id="caprinosValorTotal" name="caprinosValorTotal" step="0.01">
                    </div>
                </div>

                <h3>üêë Ovinos</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="ovinosNumero">N√∫mero de animais (12 meses):</label>
                        <input type="number" id="ovinosNumero" name="ovinosNumero" min="0">
                    </div>
                    <div class="form-group">
                        <label for="ovinosValorTotal">Valor total dos animais (R$):</label>
                        <input type="number" id="ovinosValorTotal" name="ovinosValorTotal" step="0.01">
                    </div>
                </div>

                <h3>üêì Aves</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="avesNumero">N√∫mero de aves (12 meses):</label>
                        <input type="number" id="avesNumero" name="avesNumero" min="0">
                    </div>
                    <div class="form-group">
                        <label for="avesValorTotal">Valor total das aves (R$):</label>
                        <input type="number" id="avesValorTotal" name="avesValorTotal" step="0.01">
                    </div>
                </div>

                <div class="form-group">
                    <label>Produtos das Aves:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="avesCarne" name="produtosAves" value="carne">
                            <label for="avesCarne">Carne</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="avesOvos" name="produtosAves" value="ovos">
                            <label for="avesOvos">Ovos</label>
                        </div>
                    </div>
                </div>

                <h3>üêü Peixes</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="peixesNumero">Produ√ß√£o de peixes (kg/12 meses):</label>
                        <input type="number" id="peixesNumero" name="peixesNumero" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="peixesValorTotal">Valor total da produ√ß√£o (R$):</label>
                        <input type="number" id="peixesValorTotal" name="peixesValorTotal" step="0.01">
                    </div>
                </div>

                <h3>üêù Abelhas</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="abelhasColmeias">N√∫mero de colmeias:</label>
                        <input type="number" id="abelhasColmeias" name="abelhasColmeias" min="0">
                    </div>
                    <div class="form-group">
                        <label for="abelhasProducaoMel">Produ√ß√£o de mel (kg/ano):</label>
                        <input type="number" id="abelhasProducaoMel" name="abelhasProducaoMel" step="0.01">
                    </div>
                </div>

                <div class="form-group">
                    <label>Produtos das Abelhas:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="abelhasMel" name="produtosAbelhas" value="mel">
                            <label for="abelhasMel">Mel</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abelhasPropolis" name="produtosAbelhas" value="propolis">
                            <label for="abelhasPropolis">Pr√≥polis</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abelhasCera" name="produtosAbelhas" value="cera">
                            <label for="abelhasCera">Cera</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="abelhasGeleia" name="produtosAbelhas" value="geleia_real">
                            <label for="abelhasGeleia">Geleia Real</label>
                        </div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="animaisRegistrados">Os animais s√£o registrados?</label>
                        <select id="animaisRegistrados" name="animaisRegistrados">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                            <option value="alguns">Alguns</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="animaisVacinados">Os animais s√£o vacinados?</label>
                        <select id="animaisVacinados" name="animaisVacinados">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                            <option value="alguns">Alguns</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 5: Dados Ambientais -->
            <div class="section form-section hidden" id="section5">
                <h2>üåø Dados Ambientais</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="possuiCEFIR">Possui CEFIR?</label>
                        <select id="possuiCEFIR" name="possuiCEFIR">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                            <option value="em_processo">Em Processo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="possuiCAR">Possui CAR?</label>
                        <select id="possuiCAR" name="possuiCAR">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                            <option value="em_processo">Em Processo</option>
                        </select>
                    </div>
                </div>

                <h3>üß™ Uso de Agrot√≥xicos</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="usaAgrotoxicos">Faz uso de agrot√≥xicos?</label>
                        <select id="usaAgrotoxicos" name="usaAgrotoxicos">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                            <option value="eventualmente">Eventualmente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tiposAgrotoxicos">Quais agrot√≥xicos s√£o utilizados?</label>
                        <textarea id="tiposAgrotoxicos" name="tiposAgrotoxicos"></textarea>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="usaEPI">Faz uso de EPI?</label>
                        <select id="usaEPI" name="usaEPI">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                            <option value="parcialmente">Parcialmente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="destinoEmbalagens">Destino das embalagens vazias:</label>
                        <select id="destinoEmbalagens" name="destinoEmbalagens">
                            <option value="">Selecione...</option>
                            <option value="posto_coleta">Posto de Coleta</option>
                            <option value="queima">Queima</option>
                            <option value="enterra">Enterra</option>
                            <option value="reutiliza">Reutiliza</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                </div>

                <h3>‚ôªÔ∏è Gest√£o de Res√≠duos</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="destinoResiduosSolidos">Destino dos res√≠duos s√≥lidos dom√©sticos:</label>
                        <select id="destinoResiduosSolidos" name="destinoResiduosSolidos">
                            <option value="">Selecione...</option>
                            <option value="coleta_municipal">Coleta Municipal</option>
                            <option value="queima">Queima</option>
                            <option value="enterra">Enterra</option>
                            <option value="reciclagem">Reciclagem</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="destinoResiduosOrganicos">Destino dos res√≠duos org√¢nicos:</label>
                        <select id="destinoResiduosOrganicos" name="destinoResiduosOrganicos">
                            <option value="">Selecione...</option>
                            <option value="compostagem">Compostagem</option>
                            <option value="alimentacao_animal">Alimenta√ß√£o Animal</option>
                            <option value="biogas">Produ√ß√£o de Biog√°s</option>
                            <option value="descarte">Descarte</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                </div>

                <h3>üíß Recursos H√≠dricos</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="captacaoMotorBomba">Faz capta√ß√£o de √°gua com motor bomba?</label>
                        <select id="captacaoMotorBomba" name="captacaoMotorBomba">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="possuiOutorgaAmbiental">Possui Outorga para capta√ß√£o?</label>
                        <select id="possuiOutorgaAmbiental" name="possuiOutorgaAmbiental">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                            <option value="em_processo">Em Processo</option>
                        </select>
                    </div>
                </div>

                <h3>üå≥ Vegeta√ß√£o e √Åreas de Prote√ß√£o</h3>
                <div class="form-group">
                    <label for="especiesNativas">Esp√©cies vegetais nativas presentes:</label>
                    <textarea id="especiesNativas" name="especiesNativas"></textarea>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="areaProtecaoPermanente">Tem √°rea de prote√ß√£o permanente?</label>
                        <select id="areaProtecaoPermanente" name="areaProtecaoPermanente">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="areaProtecaoAmbiental">Tem √°rea de prote√ß√£o ambiental?</label>
                        <select id="areaProtecaoAmbiental" name="areaProtecaoAmbiental">
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">N√£o</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 6: Finaliza√ß√£o e Assinatura -->
            <div class="section form-section hidden" id="section6">
                <h2>üìù Finaliza√ß√£o do Diagn√≥stico</h2>
                
                <div class="form-group">
                    <label for="observacoesGerais">Observa√ß√µes Gerais:</label>
                    <textarea id="observacoesGerais" name="observacoesGerais" rows="6"></textarea>
                </div>

                <h3>üìã Dados do T√©cnico</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="tecnicoResponsavel">T√©cnico/Analista Respons√°vel:</label>
                        <input type="text" id="tecnicoResponsavel" name="tecnicoResponsavel" required>
                    </div>
                    <div class="form-group">
                        <label for="instituicao">Institui√ß√£o:</label>
                        <input type="text" id="instituicao" name="instituicao" required>
                    </div>
                    <div class="form-group">
                        <label for="dataVisita">Data da Visita:</label>
                        <input type="date" id="dataVisita" name="dataVisita" required>
                    </div>
                    <div class="form-group">
                        <label for="localVisita">Local da Visita:</label>
                        <input type="text" id="localVisita" name="localVisita" required>
                    </div>
                </div>

                <div class="form-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="declaracaoVeracidade" name="declaracaoVeracidade" required>
                        <label for="declaracaoVeracidade">
                            <strong>Declaro que as informa√ß√µes acima expressam a verdade</strong>
                        </label>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn-primary">üíæ Salvar Diagn√≥stico Completo</button>
                    <button type="button" id="exportBtn" class="btn-secondary">üì§ Exportar Dados</button>
                    <button type="button" id="clearBtn" class="btn-danger">üóëÔ∏è Limpar Dados</button>
                </div>
            </div>
        </form>

        <div class="saved-data">
            <h3>üìä Diagn√≥sticos Salvos</h3>
            <div id="savedDataContainer">
                <p style="color: #666; text-align: center;">Nenhum diagn√≥stico salvo ainda</p>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        class DiagnosticoRural {
            constructor() {
                this.storageKey = 'diagnosticoRuralData';
                this.currentSection = 1;
                this.totalSections = 6;
                this.init();
            }

            init() {
                this.loadSavedData();
                this.setupEventListeners();
                this.updateDataCount();
                this.updateProgress();
                
                // Definir data atual como padr√£o
                document.getElementById('dataVisita').valueAsDate = new Date();
            }

            setupEventListeners() {
                document.getElementById('diagnosticoForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveDiagnostico();
                });

                document.getElementById('exportBtn').addEventListener('click', () => {
                    this.exportData();
                });

                document.getElementById('clearBtn').addEventListener('click', () => {
                    this.clearAllData();
                });

                // Auto-save quando muda de se√ß√£o
                document.addEventListener('change', () => {
                    this.autoSave();
                });
            }

            saveDiagnostico() {
                const formData = new FormData(document.getElementById('diagnosticoForm'));
                const data = {};
                
                // Converter FormData para objeto
                for (let [key, value] of formData.entries()) {
                    if (data[key]) {
                        // Se j√° existe, transformar em array
                        if (Array.isArray(data[key])) {
                            data[key].push(value);
                        } else {
                            data[key] = [data[key], value];
                        }
                    } else {
                        data[key] = value;
                    }
                }

                // Coletar checkboxes
                const checkboxGroups = ['participacao', 'documentacao', 'fontesAgua', 'praticas', 'implementos', 'estruturas', 'produtosBovinos', 'produtosAves', 'produtosAbelhas'];
                checkboxGroups.forEach(group => {
                    const checkboxes = document.querySelectorAll(`input[name="${group}"]:checked`);
                    data[group] = Array.from(checkboxes).map(cb => cb.value);
                });

                // Adicionar metadata
                data.id = Date.now() + Math.random().toString(36).substr(2, 9);
                data.timestamp = new Date().toISOString();
                data.timestampFormatted = new Date().toLocaleString('pt-BR');

                // Recuperar dados existentes
                let savedData = this.getSavedData();
                savedData.push(data);

                // Salvar
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(savedData));
                    this.showNotification('‚úÖ Diagn√≥stico salvo com sucesso!', 'success');
                    this.clearForm();
                    this.loadSavedData();
                    this.updateDataCount();
                    this.goToSection(1); // Voltar para primeira se√ß√£o
                } catch (error) {
                    this.showNotification('‚ùå Erro ao salvar: ' + error.message, 'error');
                }
            }

            autoSave() {
                // Salvar rascunho automaticamente
                const formData = new FormData(document.getElementById('diagnosticoForm'));
                const data = {};
                
                for (let [key, value] of formData.entries()) {
                    data[key] = value;
                }

                try {
                    localStorage.setItem('diagnostico_rascunho', JSON.stringify(data));
                } catch (error) {
                    console.log('Erro no auto-save:', error);
                }
            }

            getSavedData() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    return [];
                }
            }

            loadSavedData() {
                const container = document.getElementById('savedDataContainer');
                const savedData = this.getSavedData();

                if (savedData.length === 0) {
                    container.innerHTML = '<p style="color: #666; text-align: center;">Nenhum diagn√≥stico salvo ainda</p>';
                    return;
                }

                // Mostrar os √∫ltimos 3 diagn√≥sticos
                const recentData = savedData.slice(-3).reverse();
                
                container.innerHTML = recentData.map(item => `
                    <div class="data-item">
                        <small>ID: ${item.id} | Salvo em: ${item.timestampFormatted}</small>
                        <strong>üë®‚Äçüåæ ${item.nome || 'Sem nome'}</strong><br>
                        üè† Propriedade: ${item.nomePropriedade || 'N√£o informado'}<br>
                        üìç ${item.municipio || 'N√£o informado'} - ${item.uf || ''}<br>
                        üåæ Cultura Principal: ${item.culturaPrincipal || 'N√£o informado'}<br>
                        üìä Classifica√ß√£o: ${item.classificacaoProdutor || 'N√£o informado'}<br>
                        üë®‚Äçüíº T√©cnico: ${item.tecnicoResponsavel || 'N√£o informado'}
                        <br><br>
                        <button onclick="diagnostico.viewDetails('${item.id}')" style="padding: 5px 10px; background: #4a7c59; color: white; border: none; border-radius: 5px; cursor: pointer;">Ver Detalhes</button>
                        <button onclick="diagnostico.deleteItem('${item.id}')" style="padding: 5px 10px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">Excluir</button>
                    </div>
                `).join('');
            }

            viewDetails(id) {
                const savedData = this.getSavedData();
                const item = savedData.find(d => d.id === id);
                if (item) {
                    const details = `
                        DIAGN√ìSTICO RURAL - DETALHES
                        =============================
                        
                        AGRICULTOR: ${item.nome || 'N/A'}
                        PROPRIEDADE: ${item.nomePropriedade || 'N/A'}
                        MUNIC√çPIO: ${item.municipio || 'N/A'} - ${item.uf || 'N/A'}
                        √ÅREA TOTAL: ${item.areaTotal || 'N/A'} ha
                        CULTURA PRINCIPAL: ${item.culturaPrincipal || 'N/A'}
                        CLASSIFICA√á√ÉO: ${item.classificacaoProdutor || 'N/A'}
                        
                        PECU√ÅRIA:
                        - Bovinos: ${item.bovinosNumero || 0} cabe√ßas
                        - Su√≠nos: ${item.suinosNumero || 0} cabe√ßas
                        - Aves: ${item.avesNumero || 0} aves
                        
                        T√âCNICO: ${item.tecnicoResponsavel || 'N/A'}
                        INSTITUI√á√ÉO: ${item.instituicao || 'N/A'}
                        DATA DA VISITA: ${item.dataVisita || 'N/A'}
                        
                        SALVO EM: ${item.timestampFormatted}
                    `;
                    alert(details);
                }
            }

            deleteItem(id) {
                if (confirm('Tem certeza que deseja excluir este diagn√≥stico?')) {
                    let savedData = this.getSavedData();
                    savedData = savedData.filter(d => d.id !== id);
                    localStorage.setItem(this.storageKey, JSON.stringify(savedData));
                    this.loadSavedData();
                    this.updateDataCount();
                    this.showNotification('üóëÔ∏è Diagn√≥stico exclu√≠do!', 'info');
                }
            }

            updateDataCount() {
                const count = this.getSavedData().length;
                document.getElementById('dataCount').textContent = `${count} diagn√≥stico${count !== 1 ? 's' : ''} salvo${count !== 1 ? 's' : ''}`;
            }

            clearForm() {
                document.getElementById('diagnosticoForm').reset();
                document.getElementById('dataVisita').valueAsDate = new Date();
                localStorage.removeItem('diagnostico_rascunho');
            }

            goToSection(sectionNumber) {
                // Esconder todas as se√ß√µes
                document.querySelectorAll('.form-section').forEach(section => {
                    section.classList.add('hidden');
                });

                // Mostrar se√ß√£o atual
                document.getElementById(`section${sectionNumber}`).classList.remove('hidden');
                
                this.currentSection = sectionNumber;
                this.updateNavigation();
                this.updateProgress();

                // Scroll para o topo
                window.scrollTo(0, 0);
            }

            updateNavigation() {
                const sectionTitles = [
                    'Dados do Agricultor',
                    'Dados da Propriedade', 
                    'Produ√ß√£o Agr√≠cola',
                    'Produ√ß√£o Pecu√°ria',
                    'Dados Ambientais',
                    'Finaliza√ß√£o'
                ];

                document.getElementById('currentSection').textContent = this.currentSection;
                document.getElementById('sectionTitle').textContent = sectionTitles[this.currentSection - 1];

                // Bot√µes de navega√ß√£o
                document.getElementById('prevBtn').disabled = this.currentSection === 1;
                document.getElementById('nextBtn').style.display = this.currentSection === this.totalSections ? 'none' : 'inline-block';
            }

            updateProgress() {
                const progress = (this.currentSection / this.totalSections) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
            }

            exportData() {
                const savedData = this.getSavedData();
                
                if (savedData.length === 0) {
                    this.showNotification('‚ö†Ô∏è Nenhum diagn√≥stico para exportar!', 'info');
                    return;
                }

                // Criar CSV detalhado
                const headers = [
                    'ID', 'Data_Salvamento', 'Nome', 'CPF', 'Municipio', 'UF', 'Telefone',
                    'Nome_Propriedade', 'Area_Total_ha', 'Area_Producao_ha', 'Classificacao_Produtor',
                    'Cultura_Principal', 'Variedade_Plantada', 'Tecnicas_Cultivo',
                    'Bovinos_Numero', 'Suinos_Numero', 'Caprinos_Numero', 'Ovinos_Numero', 'Aves_Numero',
                    'Usa_Agrotoxicos', 'Possui_CAR', 'Possui_CEFIR', 'Tecnico_Responsavel', 'Instituicao',
                    'Data_Visita', 'Observacoes_Gerais'
                ];

                const csvContent = [
                    headers.join(','),
                    ...savedData.map(item => [
                        item.id,
                        item.timestamp,
                        `"${(item.nome || '').replace(/"/g, '""')}"`,
                        item.cpf || '',
                        `"${(item.municipio || '').replace(/"/g, '""')}"`,
                        item.uf || '',
                        item.telefone || '',
                        `"${(item.nomePropriedade || '').replace(/"/g, '""')}"`,
                        item.areaTotal || '',
                        item.areaProducao || '',
                        item.classificacaoProdutor || '',
                        `"${(item.culturaPrincipal || '').replace(/"/g, '""')}"`,
                        `"${(item.variedadePlantada || '').replace(/"/g, '""')}"`,
                        item.tecnicasCultivo || '',
                        item.bovinosNumero || 0,
                        item.suinosNumero || 0,
                        item.caprinosNumero || 0,
                        item.ovinosNumero || 0,
                        item.avesNumero || 0,
                        item.usaAgrotoxicos || '',
                        item.possuiCAR || '',
                        item.possuiCEFIR || '',
                        `"${(item.tecnicoResponsavel || '').replace(/"/g, '""')}"`,
                        `"${(item.instituicao || '').replace(/"/g, '""')}"`,
                        item.dataVisita || '',
                        `"${(item.observacoesGerais || '').replace(/"/g, '""')}"`
                    ].join(','))
                ].join('\n');

                // Download do arquivo
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `diagnostico_rural_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                this.showNotification(`üìä ${savedData.length} diagn√≥stico(s) exportado(s)!`, 'success');
            }

            clearAllData() {
                if (confirm('‚ö†Ô∏è Tem certeza que deseja limpar todos os diagn√≥sticos salvos? Esta a√ß√£o n√£o pode ser desfeita!')) {
                    localStorage.removeItem(this.storageKey);
                    localStorage.removeItem('diagnostico_rascunho');
                    this.loadSavedData();
                    this.updateDataCount();
                    this.showNotification('üóëÔ∏è Todos os dados foram removidos!', 'info');
                }
            }

            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');

                setTimeout(() => {
                    notification.classList.remove('show');
                }, 4000);
            }
        }

        // Fun√ß√µes globais para navega√ß√£o
        function nextSection() {
            if (diagnostico.currentSection < diagnostico.totalSections) {
                diagnostico.goToSection(diagnostico.currentSection + 1);
            }
        }

        function previousSection() {
            if (diagnostico.currentSection > 1) {
                diagnostico.goToSection(diagnostico.currentSection - 1);
            }
        }

        // Inicializar aplica√ß√£o
        let diagnostico;
        document.addEventListener('DOMContentLoaded', () => {
            diagnostico = new DiagnosticoRural();
            
            // Registrar Service Worker para PWA
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('service-worker.js')
                        .then(registration => {
                            console.log('SW registrado:', registration);
                        })
                        .catch(registrationError => {
                            console.log('Erro no SW:', registrationError);
                        });
                });
            }
        });

        // Detectar status de conex√£o
        window.addEventListener('online', () => {
            document.getElementById('statusText').textContent = 'Conectado - Sincroniza√ß√£o dispon√≠vel';
        });

        window.addEventListener('offline', () => {
            document.getElementById('statusText').textContent = 'Modo Offline - Dados salvos localmente';
        });

        // Carregar rascunho se existir
        window.addEventListener('load', () => {
            try {
                const rascunho = localStorage.getItem('diagnostico_rascunho');
                if (rascunho && confirm('Existe um rascunho salvo. Deseja carreg√°-lo?')) {
                    const data = JSON.parse(rascunho);
                    Object.keys(data).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            element.value = data[key];
                        }
                    });
                }
            } catch (error) {
                console.log('Erro ao carregar rascunho:', error);
            }
        });
    </script>
</body>
</html>
                